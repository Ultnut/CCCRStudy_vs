## 로드 밸런스란?   (L4,L7)


### 로드밸런싱

- 부하분산 또는 로드밸런싱은 컴퓨터 네트워크 기술의 일종으로 둘 혹은 셋이상의 중앙처리장치 혹은 저장장치와 같은 컴퓨터 자원들에게 작업을 나누는 것

#### 로드밸런서 종류

- 운영체제 로드밸런서
  - 물리적 프로세서 간에 작업을 스케쥴링
- 네트워크 로드밸런서
  - 사용 가능한 백엔드에서 네트워크 작업을 스케쥴링
  
- 스위치의 역활 : 허브가 한 포트로 신호가 들어오면 같은 신호를 다른 포트로 전달하는 것에 비해, 스위치는 신호를 필요로 하는 포트로만 신호를 전달 즉 스위치에서는 불필요한 트래픽이 감소하고 데이터 전송의 향상으로 로드밸런서와 비슷하다.

#### 네트워크 로드밸런서 종류

- L2
  -   브릿지 , 허브 등
  -   구조가 간단하고 신뢰성이 높음
  -   브로드 캐스트 패킷에 의해 성능저하 발생, 라우팅 등 상위 레이어 프로토콜 기반 스위칭 불가
- L3
  - ROUTER, ICMP, IP
  - 브로드캐스트 트래픽으로 전체 성능 저하 방지, 트레픽 체크
  - 특정 프로토콜을 이용해야 스위칭 가능
- L4
  - TCP, UDP
  - 포트 기반의 스위칭 지원, VIP 를 이용하여 여러대를 한대로 묶어 부하분산\
  - 주로 ROUND ROBIN 방식 사용
- L7
  -  IP+PORT+패킷내용
  -  HTTP, FTP, SMTP


### 로드밸런서 동작예 (L4)

![L4LB](https://miro.medium.com/max/700/1*eCJk5cWVw2mfefvx7LkGTA.png)
   1. 브라우저에서 aaa.co.kr 이라고 입력
    PC에 설정된 Local DNS 서버로 DNS Query
    Local DNS 서버는 aaa.co.kr을 관리하는 DNS서버(Authoritative DNS서버)에 DNS Query, L4의 VIP주소 획득
2. Local DNS는 획득한 VIP 주소를 전송
3.  획득한 DNS를 기반으로 L4 VIP로 http 요청
 4.   L/B장비는 최적의 서비스 서버를 내부 알고리즘(라운드로빈 등)을 통하여 선별, 요청을 전송
    그 후 서버 작업 결과를 L/B장비 전송
5. 전달받은 http결과를 L/B장비를 통해 Client에 전송함으로 요청 처리를 끝낸다.
  